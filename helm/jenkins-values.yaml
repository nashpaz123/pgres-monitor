# Jenkins Configuration
controller:
  componentName: "jenkins-master"
  numExecutors: 0  # Use dynamic agents only
  disableCSRFProtection: false
  
  # Persistence
  persistence:
    enabled: true
    size: 20Gi
    storageClass: "standard"
  
  # Resources
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi
  
  # Service
  serviceType: ClusterIP
  servicePort: 8080
  
  # Configure Jenkins root URL for path-based access
  # Use JENKINS_OPTS instead of additionalArguments for prefix
  env:
    - name: JENKINS_OPTS
      value: "--prefix=/jenkins"
  jenkinsUrl: http://127.0.0.1/jenkins/
  
  # Jenkins Configuration as Code
  JCasC:
    defaultConfig: true
    configScripts:
      kubernetes-plugin: |
        jenkins:
          clouds:
            - kubernetes:
                name: "kubernetes"
                serverUrl: ""
                namespace: "monitoring"
                jenkinsUrl: "http://jenkins.monitoring.svc.cluster.local:8080"
                jenkinsTunnel: "jenkins-agent.monitoring.svc.cluster.local:50000"
                containerCap: 10
                maxRequestsPerHost: 32
                retentionTimeout: 5
                connectTimeout: 100
                readTimeout: 100
                templates:
                  - name: "kubernetes"
                    label: "kubernetes"
                    nodeUsageMode: NORMAL
                    containers:
                      - name: "jnlp"
                        image: "jenkins/inbound-agent:latest"
                        alwaysPullImage: false
                        workingDir: "/home/jenkins/agent"
                        command: ""
                        args: ""
                        resourceRequestCpu: "100m"
                        resourceRequestMemory: "256Mi"
                        resourceLimitCpu: "500m"
                        resourceLimitMemory: "512Mi"
                    yaml: |
                      apiVersion: v1
                      kind: Pod
                      spec:
                        containers:
                          - name: jnlp
                            image: jenkins/inbound-agent:latest
                            env:
                              - name: JENKINS_URL
                                value: http://jenkins.monitoring.svc.cluster.local:8080
                              - name: JENKINS_SECRET
                                valueFrom:
                                  secretKeyRef:
                                    name: jenkins-agent-secret
                                    key: secret
                              - name: JENKINS_AGENT_NAME
                                valueFrom:
                                  fieldRef:
                                    fieldPath: metadata.name
                            securityContext:
                              privileged: false
                              runAsUser: 1000
                              runAsGroup: 1000
  
  # Install plugins
  installPlugins:
    - kubernetes:latest
    - workflow-aggregator:latest
    - git:latest
    - job-dsl:latest
    - configuration-as-code:latest
    - timestamper:latest
    - ansicolor:latest
  
  # Additional plugins
  additionalPlugins:
    - kubernetes-cli:latest

agent:
  enabled: true
  defaultsProviderTemplate: "kubernetes"
  containerCap: 10
  maxRequestsPerHost: 32
  retentionTimeout: 5
  connectTimeout: 100
  readTimeout: 100

serviceAccount:
  create: true
  annotations: {}

rbac:
  create: true

